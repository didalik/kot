#!/bin/bash
#
# This bin/bit/hx/dev/useTM script requires 'npm run dev' in another terminal.
# It starts the browser with the URL $1, and then communicates with it
# using Stellar Test Monitor (TM).
##

help () { # {{{1
  local error=$?
  local red=$(git config --get-color color.diff.whitespace "red")
  local reset=$(git config --get-color "" "reset")
  echo -n "${red}"
	echo -e "ERROR $error\n\tRequired argument: the URL. Usage example:\n\n\t$0 http://ko:8787/hx_use_tm\n"
  echo -n "${reset}"
}

log () { # {{{1
  local blue=$(git config --get-color color.diff.whitespace "blue")
  local reset=$(git config --get-color "" "reset")
  echo "${blue}$@${reset}"
}

run () { # {{{1
	log "run $# $@"
  ssh alec@mba open "$1"
  #ssh alec@mba open "$1" FIXME
  echo '{"key":"value"}' | bin/dev.mjs hx_use_tm
}

validate () { # {{{1
	log "$USER validate $# $@"
  if [ $# -ne 1 ]; then
    return 1
  fi
  return 0
}

log "$0 started for $USER@$HOSTNAME on $(date) in $PWD" # {{{1
validate $@ && run $@ || help $@
log "$0 DONE for $USER@$HOSTNAME"
